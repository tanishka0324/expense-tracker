<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Advanced Expense Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; transition: 0.3s; }
    .dark { background: #121212; color: #ddd; }
    .container { max-width: 700px; margin: 20px auto; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .dark .container { background: #1e1e1e; }
    h2, h3 { text-align: center; }
    .btn { padding: 8px 15px; border: none; cursor: pointer; border-radius: 5px; }
    .btn-dark { background: #333; color: #fff; }
    .btn-light { background: #f1f1f1; color: #333; }
    input, select { padding: 6px; margin: 5px; border: 1px solid #ccc; border-radius: 5px; }
    ul { list-style: none; padding: 0; }
    li { padding: 6px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; }
    .chart-container { margin-top: 20px; background: #fafafa; padding: 10px; border-radius: 10px; }
    .dark .chart-container { background: #2a2a2a; }
    .actions button { margin-left: 5px; }
    .summary { font-weight: bold; margin: 10px 0; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üí∞ Advanced Expense Tracker</h2>
    <button id="toggleDark" class="btn btn-light">üåô Dark Mode</button>
    
    <div>
      <input type="text" id="name" placeholder="Name" />
      <input type="number" id="amount" placeholder="‚Çπ Amount" />
      <input type="date" id="date" />
      <select id="category">
        <option>Food</option>
        <option>Travel</option>
        <option>Shopping</option>
        <option>Entertainment</option>
        <option>Other</option>
      </select>
      <button id="addBtn" class="btn btn-dark">Add</button>
    </div>

    <div>
      <label>Filter by Month:</label>
      <select id="monthFilter">
        <option value="all">All</option>
      </select>
    </div>

    <div class="summary">Total Expense: ‚Çπ<span id="totalExpense">0</span></div>

    <h3>Transactions</h3>
    <ul id="transactionList"></ul>

    <div class="chart-container">
      <canvas id="expenseChart"></canvas>
    </div>
  </div>

<script>
  const nameInput = document.getElementById("name");
  const amountInput = document.getElementById("amount");
  const dateInput = document.getElementById("date");
  const categoryInput = document.getElementById("category");
  const addBtn = document.getElementById("addBtn");
  const transactionList = document.getElementById("transactionList");
  const monthFilter = document.getElementById("monthFilter");
  const totalExpenseEl = document.getElementById("totalExpense");

  let transactions = JSON.parse(localStorage.getItem("expenses")) || [];
  let editingIndex = null;

  // Initialize Chart.js
  const ctx = document.getElementById("expenseChart").getContext("2d");
  let chart = new Chart(ctx, {
    type: "pie",
    data: { labels: [], datasets: [{ data: [], backgroundColor: ["#A3C4F3","#F7D9C4","#C1E1C1","#E5D4ED","#F8E1F4","#FEC5BB"] }] }
  });

  function saveData() {
    localStorage.setItem("expenses", JSON.stringify(transactions));
  }

  function updateMonthFilter() {
    const months = new Set(transactions.map(t => t.date.slice(0,7)));
    monthFilter.innerHTML = `<option value="all">All</option>`;
    months.forEach(m => {
      const option = document.createElement("option");
      option.value = m;
      option.textContent = m;
      monthFilter.appendChild(option);
    });
  }

  function calculateTotal(filtered) {
    const total = filtered.reduce((sum, t) => sum + t.amount, 0);
    totalExpenseEl.textContent = total.toFixed(2);
  }

  function renderTransactions() {
    const filterMonth = monthFilter.value;
    const filtered = filterMonth === "all" ? transactions : transactions.filter(t => t.date.startsWith(filterMonth));
    
    transactionList.innerHTML = "";
    filtered.forEach((t, i) => {
      const li = document.createElement("li");
      li.innerHTML = `${t.name} - ‚Çπ${t.amount} (${t.category}, ${t.date})
        <span class="actions">
          <button onclick="editTransaction(${i})">‚úèÔ∏è</button>
          <button onclick="deleteTransaction(${i})">‚ùå</button>
        </span>`;
      transactionList.appendChild(li);
    });
    calculateTotal(filtered);
    updateChart(filtered);
  }

  function updateChart(data) {
    const categoryTotals = {};
    data.forEach(t => categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount);
    chart.data.labels = Object.keys(categoryTotals);
    chart.data.datasets[0].data = Object.values(categoryTotals);
    chart.update();
  }

  addBtn.addEventListener("click", () => {
    const name = nameInput.value.trim();
    const amount = parseFloat(amountInput.value);
    const date = dateInput.value;
    const category = categoryInput.value;

    if (!name || !amount || !date) return alert("Fill all fields!");

    const newTransaction = { name, amount, date, category };

    if (editingIndex !== null) {
      transactions[editingIndex] = newTransaction;
      editingIndex = null;
      addBtn.textContent = "Add";
    } else {
      transactions.push(newTransaction);
    }

    saveData();
    updateMonthFilter();
    renderTransactions();

    nameInput.value = amountInput.value = dateInput.value = "";
  });

  function editTransaction(i) {
    const t = transactions[i];
    nameInput.value = t.name;
    amountInput.value = t.amount;
    dateInput.value = t.date;
    categoryInput.value = t.category;
    editingIndex = i;
    addBtn.textContent = "Update";
  }

  function deleteTransaction(i) {
    transactions.splice(i, 1);
    saveData();
    updateMonthFilter();
    renderTransactions();
  }

  document.getElementById("toggleDark").addEventListener("click", () => {
    document.body.classList.toggle("dark");
  });

  monthFilter.addEventListener("change", renderTransactions);

  // Initialize
  updateMonthFilter();
  renderTransactions();
</script>
</body>
</html>
